language: c

sudo: false

cache:
  directories:
    - $HOME/.openfortivpn-deps

before_install:
  - tests/ci/install_astyle.sh $HOME/.openfortivpn-deps
  - tests/ci/install_openssl.sh $HOME/.openfortivpn-deps

install:
  - ./autogen.sh
  - PKG_CONFIG_PATH=$HOME/.openfortivpn-deps/lib/pkgconfig ./configure --prefix=/usr --sysconfdir=/etc
  - make

script:
  - ./tests/lint/run.sh

env:
  global:
    # COVERITY_SCAN_TOKEN
    - secure: "FXGMUAl9aosC8HuL8c56jp876I4Tg/duuP6vYOSyl6uWPva7fsXHQKgkhrPh5IuHDcC/seVJIbI88W9doPFKYcK3UMwgNk1op2K/BtcP5ZOWxCuyFha/J9n4dlUJqZRESV5DOKEcLPm/RuTFvLd/hfi29bL5W0zBPytT+bYJ9ydIdI5UtRXLOUjm4G4bV8/myDy8V7O1CYeBKaQ3X+f/H4pySRy4751UUpctTVOue7AvMclNmM5F4At1dFtqwoeDXXFE3+/4wOQlOXYKC6htVPooPPDgU4vNKc5XrGqPL80AEUAfIExMEeSh6nFxVsrHB5grGxEA0fGMq28jUByGQfCYI4FOgj8xNPM8POa26Mu4RZVWmAUQia4Sdun9wEIr+AbM7Vjr5QN1WvScSyfvt3StPKC1F0jutArWCwoL2YDbm8lcueCHjif/eGlD5SR7uNyRmkU1DoJqDbUV0SSj9h4unVHSdKESiEKgIsDkXvxpW8/Aajj0dwctWB2utGisjBIKw1OOfLXs6/aAdnvkQH/CZ4eCWZd/wpJGCMnAI5hs3Lep8d5hMOTF5LzFK3t8e/CVdSei5gSGVzEYLCANucQ86kngdz66bBAHQWtDplLPp2VCy0wJwyjxaZWunb2dvVz/4xlF0o5RafDM4uQ3fRoPLANjFQa6GyLreVt7tdQ="

addons:
  coverity_scan:
    project:
      name: adrienverge/openfortivpn
      description: Client for PPP+SSL VPN tunnel services 
    notification_email: adrienverge@users.noreply.github.com
    build_command_prepend: ./configure --prefix=/usr --sysconfdir=/etc; make clean
    build_command: make -j 4
    branch_pattern: coverity_scan
